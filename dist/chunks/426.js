"use strict";(self.webpackChunkwp_travel_engine=self.webpackChunkwp_travel_engine||[]).push([[426],{426:(e,t,a)=>{a.r(t),a.d(t,{bookingModalContext:()=>ie,useBookingModalContext:()=>se});var n=a(1609),r=a(6087);const l=({isOpen:e,setIsOpen:t,children:a})=>{const l=(0,r.useRef)(null),i=(0,r.useRef)(null);(0,r.useEffect)((()=>{e&&(document.body.style.overflow="hidden",i.current.classList.add("showing"),setTimeout((()=>{i.current.classList.remove("showing")}),300))}),[e]);const s=()=>{document.body.style.overflow="",i.current.classList.add("hiding"),setTimeout((()=>{t(!1)}),300)};return(0,n.createElement)(n.Fragment,null,e&&(0,r.createPortal)((0,n.createElement)("div",{ref:i,className:"wpte-modal__screen-overlay",onClick:e=>{l.current.contains(e.target)||s()}},(0,n.createElement)("div",{ref:l,className:"wpte-modal"},(0,n.createElement)("button",{type:"button",role:"close-button",className:"wpte-modal__close-button",onClick:()=>s()},(0,n.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24","aria-hidden":"true",focusable:"false"},(0,n.createElement)("path",{d:"M13 11.8l6.1-6.3-1-1-6.1 6.2-6.1-6.2-1 1 6.1 6.3-6.5 6.7 1 1 6.5-6.6 6.5 6.6 1-1z"}))),a)),document.body))};var i=a(7143),s=a(6154),c=a.n(s);const o=(0,n.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"2",viewBox:"0 0 14 2"},(0,n.createElement)("path",{"data-name":"Path 23951",d:"M0,0H12",transform:"translate(1 1)",fill:"none",stroke:"#170d44",strokeLinecap:"round",strokeWidth:"2",opacity:"0.5"})),m=(0,n.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14"},(0,n.createElement)("g",{"data-name":"Group 2263",transform:"translate(-78 -14)",opacity:"0.5"},(0,n.createElement)("line",{"data-name":"Line 2",x2:"12",transform:"translate(79 21)",fill:"none",stroke:"#170d44",strokeLinecap:"round",strokeWidth:"2"}),(0,n.createElement)("line",{"data-name":"Line 3",x2:"12",transform:"translate(84.999 15) rotate(90)",fill:"none",stroke:"#170d44",strokeLinecap:"round",strokeWidth:"2"}))),p=(0,n.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"13",height:"14",viewBox:"0 0 13 14"},(0,n.createElement)("g",{id:"Group_2371","data-name":"Group 2371",transform:"translate(0)"},(0,n.createElement)("rect",{id:"Rectangle_1682","data-name":"Rectangle 1682",width:"13",height:"3",transform:"translate(0)",fill:"#170d44",opacity:"0.6"}),(0,n.createElement)("g",{id:"Rectangle_1683","data-name":"Rectangle 1683",transform:"translate(0 3)",fill:"none",strokeWidth:"1",opacity:"0.6"},(0,n.createElement)("rect",{width:"13",height:"11",stroke:"none"}),(0,n.createElement)("rect",{x:"0.5",y:"0.5",width:"12",height:"10",fill:"none"})))),d=(0,n.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"14.812",viewBox:"0 0 10 14.812"},(0,n.createElement)("g",{id:"Group_2254","data-name":"Group 2254",transform:"translate(-1072.099 -77)"},(0,n.createElement)("g",{id:"Group_2416","data-name":"Group 2416",transform:"translate(1072.099 77)"},(0,n.createElement)("path",{id:"Path_23953","data-name":"Path 23953",d:"M33.115,6.1h-1.6V4.317a1.055,1.055,0,0,0-1.158-.9h-2.02a1.055,1.055,0,0,0-1.158.9V6.1h-1.6a1.121,1.121,0,0,0-1.232.958v9.236a1.1211.121,0,0,0,1.232.958h.628v.594a.448.448,0,0,0,.492.383h.32a.448.448,0,0,0,.493-.383v-.594h3.67v.594a.448.448,0,0,0,.493.383h.32a.448.448,0,0,0,.493-.383v-.594h.628a1.121,1.121,00,0,1.232-.958V7.057A1.12,1.12,0,0,0,33.115,6.1Zm-5.1-1.782a.292.292,0,0,1,.32-.249h2.02a.292.292,0,0,1,.32.249V6.1h-2.66Z",transform:"translate(-24.346 -3.416)"})))),u=(0,n.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"4",viewBox:"0 0 16 4"},(0,n.createElement)("g",{id:"Group_2257","data-name":"Group 2257",transform:"translate(-349.914 -82)"},(0,n.createElement)("g",{id:"Group_2418","data-name":"Group 2418"},(0,n.createElement)("circle",{id:"Ellipse_100","data-name":"Ellipse 100",cx:"2",cy:"2",r:"2",transform:"translate(349.914 82)"}),(0,n.createElement)("circle",{id:"Ellipse_101","data-name":"Ellipse 101",cx:"2",cy:"2",r:"2",transform:"translate(355.914 82)"}),(0,n.createElement)("circle",{id:"Ellipse_102","data-name":"Ellipse 102",cx:"2",cy:"2",r:"2",transform:"translate(361.914 82)"})))),g=(0,n.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"6",height:"8.226",viewBox:"0 0 6 8.226"},(0,n.createElement)("path",{id:"Path_23222","data-name":"Path 23222",d:"M361.369,288.944a1.569,1.569,0,0,0-1.026,1.453v.365h-1.014a4.251,4.251,0,0,1,.119-1.217,2.424,2.424,0,0,1,1.026-1.126c.9-.536,1.311-1.088,1.252-1.656-.089-.81-.611-1.238-1.56-1.292a1.956,1.956,0,0,0-2.1,1.656l-1.079-.466.178-.418c.492-1.147,1.554-1.7,3.179-1.656,1.607.08,2.485.783,2.633,2.1q.134,1.254-1.607,2.262Zm-1.014,3.865h-1.026v-1.034h1.026Z",transform:"translate(-356.985 -284.584)",fill:"#170d44"})),v=(0,n.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"5.81",height:"10.121",viewBox:"0 0 5.81 10.121"},(0,n.createElement)("path",{id:"Path_23963","data-name":"Path 23963",d:"M3290.465,368.331l4,4-4,4",transform:"translate(-3289.404 -367.271)",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",opacity:"0.8"})),h=(0,n.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"5.811",height:"10.121",viewBox:"0 0 5.811 10.121"},(0,n.createElement)("path",{id:"Path_23952","data-name":"Path 23952",d:"M3294.464,368.331l-4,4,4,4",transform:"translate(-3289.714 -367.271)",fill:"none",stroke:"#147dfe",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"})),w=(0,n.createElement)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,n.createElement)("path",{d:"M6 9L12 15L18 9",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})),E=(0,n.createElement)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,n.createElement)("path",{d:"M18 15L12 9L6 15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})),b={minus:o,plus:m,calendar:p,suitcase:d,dots:u,help:g,"angle-right":v,"angle-left":h,"angle-down":w,"angle-up":E},f=({icon:e})=>b[e],y=({onClick:e,type:t="button",label:a,className:r="",disabled:l=!1})=>"string"==typeof a?(0,n.createElement)("button",{dangerouslySetInnerHTML:{__html:a},type:t,onClick:e,className:r,disabled:l}):(0,n.createElement)("button",{type:t,onClick:e,className:r,disabled:l},a),k=({value:e,onChange:t,min:a=-1/0,max:r=1/0})=>(0,n.createElement)("div",{className:"wte-qty-number wte-booking-pc-counter","data-info":'{"packageID":6052,"catID":15}'},(0,n.createElement)(y,{className:"prev wte-down",disabled:e-1<a,onClick:()=>t(e-1),label:o}),(0,n.createElement)("input",{type:"text",value:e,readOnly:!0}),(0,n.createElement)(y,{className:"next wte-up",disabled:e+1>r,onClick:()=>t(e+1),label:m}));var T=a(7723);const _=({options:e,checked:t,onChange:a,isShowMore:l=!1})=>{const[i,s]=(0,r.useState)(!1),c=!i&&l?e.slice(0,3):e;return(0,n.createElement)("div",{className:"wte-button-group",role:"group","aria-label":"Toggle Button Group"},c.map((({label:e,value:r})=>(0,n.createElement)("div",{key:r},(0,n.createElement)("input",{type:"radio",name,id:`btn_radio_${r}`,style:{position:"absolute",clip:"rect(0, 0, 0, 0)",pointerEvents:"none"},autoComplete:"off",checked:r===t,onChange:()=>a(r)}),(0,n.createElement)("label",{className:"wte-check-button"+(r===t?" checked":""),htmlFor:`btn_radio_${r}`,dangerouslySetInnerHTML:{__html:e}})))),l&&e.length>3&&(0,n.createElement)("button",{type:"butotn",className:"wte-check-button",onClick:()=>s(!i),style:{paddingLeft:"20px",paddingRight:"20px"}},i?(0,T.__)("Show Less","wp-travel-engine"):(0,T.__)("Show More","wp-travel-engine"),(0,n.createElement)(f,{icon:i?"angle-up":"angle-down"})))};var x=a(1504);const S=({content:e,children:t,...a})=>(0,n.createElement)(x.Ay,{interactive:!0,content:e,...a},t),{priceFormat:N}=wteL10n,L=({value:e,noHTML:t=!1,convert:a=!0})=>(0,n.createElement)("span",{dangerouslySetInnerHTML:{__html:N(e).format(t,a)}}),C=({value:e,options:t,onChange:a})=>(0,n.createElement)("div",{className:"wpte-select-options"},(0,n.createElement)("select",{className:"option-toggle",value:e,onChange:e=>a(e.target.value)},t?.map((({value:e,label:t},a)=>(0,n.createElement)("option",{key:e,value:e},t))))),P=e=>{const{direction:t="horizontal",required:a=!1,label:r,helpText:l,hasSale:i,actualPrice:s,price:c,ageGroup:o,perTextLabel:m,counter:{min:p,max:d,onChange:u,value:g},afterLabel:v=""}=e;return""===c?null:(0,n.createElement)("div",{className:`wte-trip-guest-wrapper ${t}`},(0,n.createElement)("div",{className:"check-in-wrapper"},(0,n.createElement)("label",{dangerouslySetInnerHTML:{__html:`${r}${o&&` (${o}) `||""}${a?'<span class="wte-required" style="color:red">&nbsp;*</span>':""}`}}),l&&(0,n.createElement)(S,{trigger:"click",content:(0,n.createElement)("div",{dangerouslySetInnerHTML:{__html:l}})},(0,n.createElement)("span",{className:"wte-meta-help"},(0,n.createElement)(f,{icon:"help"}))),v),(0,n.createElement)("div",{className:"select-wrapper"},(0,n.createElement)("div",{className:"amount-per-person"},i&&(0,n.createElement)("span",{className:"regular-price"},(0,n.createElement)("del",null,(0,n.createElement)(L,{value:s}))),(0,n.createElement)("span",{className:"offer-price"},(0,n.createElement)(L,{value:c})),m&&(0,n.createElement)("span",{className:"per-text"},m)),(0,n.createElement)(k,{value:g,min:p,max:d,onChange:u})))},D=({children:e,heading:t})=>(0,n.createElement)(n.Fragment,null,t&&(0,n.createElement)("div",{className:"wte-option-heading"},t," "),(0,n.createElement)("div",{className:"wte-trip-options"},e())),{locale:I}=wteL10n,q=({options:e})=>{const t=(0,r.useRef)(null),a=(0,r.useRef)(null),l=(0,r.useCallback)((()=>{var n,r;a.current&&a.current.destroy(),a.current=flatpickr(t.current,e),flatpickr.localize(null!==(n=flatpickr?.l10ns?.[null!==(r=I.split("_")[0])&&void 0!==r?r:"en"])&&void 0!==n?n:"en")}),[e]);return(0,r.useEffect)((()=>(l(),()=>{a.current&&a.current.destroy()})),[l]),(0,n.createElement)("div",{ref:t})};var M=a(8193);const R=({onDateChange:e,onTimeChange:t})=>{var a,l;const{state:s,setState:o}=se(),{tripID:m,availableTimes:p,summary:d,summary:{selectedTripDate:u,selectedTimeSlot:g}}=s,v=(0,i.useSelect)((e=>e("wptravelengine").getTripDates(m)),[m]),h=(0,r.useMemo)((()=>v?.reduce(((e,t)=>({...e,...t.dates})),{})),[v]),w=Object.keys(h).sort()[0];(0,r.useEffect)((()=>{setTimeout((()=>{!u&&e(Object.keys(h).sort()[0])}),100)}),[w]);const E=null!==(a=v?.filter((({dates:e})=>!!e[u])))&&void 0!==a?a:[];return(0,n.createElement)("div",{className:"wte-process-tab-content-wrapper"},(0,n.createElement)("div",{id:"wte-booking-datetime-content"},(0,n.createElement)("div",{className:"wte-process-tab-content"},(0,n.createElement)("div",{className:"wte-booking-date-wrap"},(0,n.createElement)(q,{options:{inline:!0,defaultDate:null!==(l=d.selectedTripDate)&&void 0!==l?l:w,minDate:w,dateFormat:"Y-m-d",onChange:(t,a)=>e(a),disable:[function(e){var t;const a=null!==(t=h[c()(e).format("YYYY-MM-DD")]?.seats)&&void 0!==t?t:-1;return(0,M.Et)(a)&&a<=0||!1}]}}),p.length>0&&(0,n.createElement)("div",null,(0,n.createElement)("div",{className:"wte-booking-times"},E.map((({package:e},a)=>{const{id:l,name:i}=e,s=p.filter((({package_id:e})=>l===e));return s.length<=0?null:(0,n.createElement)(r.Fragment,{key:a},E.length>1&&i&&(0,n.createElement)("span",{className:"wte-package-name",dangerouslySetInnerHTML:{__html:i}}),(0,n.createElement)(_,{options:s.map((({from:e,to:t,key:a})=>({label:`${c()(e).format("h:mm A")} - ${c()(t).format("h:mm A")}`,value:a}))),checked:g,onChange:t,isShowMore:!0}))}))))))))};var $=a(8468);const B=({item:e,onChange:t})=>{var a;const[l,i]=(0,r.useState)(e.options[0].key),{state:{summary:{extraServices:s}}}=se(),{title:c,options:o,required:m,multiple:p}=e,d={required:m},u=(0,$.keyBy)(s,"id");if(p&&o.length>1)return o.map(((e,a)=>{var r;const{price:l,label:i,key:s}=e;return(0,n.createElement)(P,{key:s,label:i,price:l,direction:"vertical",perTextLabel:`/ ${e.serviceUnit.label}`,helpText:e.description,counter:{min:0,max:1/0,value:null!==(r=u[s]?.qty)&&void 0!==r?r:0,onChange:a=>t(e,a)}})}));const g=!p&&o.length>1?(0,n.createElement)(C,{options:o.map((({label:e,key:t},a)=>({value:t,label:e}))),value:l,onChange:e=>{i(e),t({key:e,price:0},0)}}):null,v=o.find((({key:e})=>e===l));return(0,n.createElement)(P,{...d,perTextLabel:`/ ${o[0].serviceUnit.label}`,price:v.price,afterLabel:g,label:c,helpText:v.description,counter:{min:0,max:1/0,value:null!==(a=u[v.key]?.qty)&&void 0!==a?a:0,onChange:e=>t(v,e)}})},O=()=>{const{state:e,setState:t}=se(),{tripID:a,summary:{extraServices:l}}=e,s=(0,i.useSelect)((e=>e("wptravelengine").getTripServices(a)),[a]);(0,r.useEffect)((()=>{t({processToNext:l.filter((({required:e})=>e)).every((({qty:e})=>e>0))})}),[]);const c=a=>({key:n,price:r,label:i},s)=>{const{required:c,options:o,multiple:m}=a,p=parseFloat(r)*s;let d=l;i||(d=d.filter((({id:e})=>!a.options.some((({key:t})=>t===e))))),d.forEach((({id:e},t)=>{o.find((({key:t})=>t===e))&&c&&(d[t].required=e===n,m&&(d[t].required=e===n?o.filter((({key:t})=>t!==e)).every((({key:e})=>0===d.find((({id:t})=>t===e)).qty)):d[t].qty>0))}));const u=d.findIndex((({id:e})=>e===n));if(-1!==u)d[u]={...d[u],qty:s,total:p};else{const{price:e,serviceUnit:t,label:a}=o.find((({key:e})=>e===n));d=[...d,{id:n,label:a,unitPrice:e,qty:s,total:p,perTextLabel:` / ${t.label}`,required:c}]}t({processToNext:d.filter((({required:e})=>e)).every((({qty:e})=>e>0)),summary:{...e.summary,extraServices:d}})};return(0,n.createElement)("div",{className:"wte-process-tab-content-wrapper"},(0,n.createElement)("h5",{className:"wte-process-tab-title"},(0,T.__)("Select Extra Services: ","wp-travel-engine")),(0,n.createElement)(D,null,(()=>s.map((e=>{return(t=B,({service:e,...a})=>{const{multiple:r,options:l,id:i,title:s,required:c}=e;return r&&l.length>1?(0,n.createElement)("div",{className:"wte-trip-options",key:i},(0,n.createElement)("h5",{className:"wte-process-tab-title"},(0,n.createElement)("span",{dangerouslySetInnerHTML:{__html:s}}),c&&(0,n.createElement)("span",{className:"wte-required",style:{color:"red"}}," *")),(0,n.createElement)("div",{className:"wte-es-with-multiple-options wte-owl-carousel"},(0,n.createElement)(t,{item:e,...a}))):(0,n.createElement)(t,{item:e,...a,key:i})})({service:e,onChange:c(e)});var t})))))},A=({options:e,onChange:t,selected:a})=>(0,n.createElement)(_,{options:e,onChange:t,checked:a}),G=({discountList:e,perTextLabel:t})=>(0,n.createElement)(x.Ay,{interactive:!0,theme:"light",placement:"bottom",trigger:"click",className:"wpte-select-options-wrapper wpte-group-discount-options",content:(0,n.createElement)("ul",{className:"options-list"},(0,n.createElement)("li",{className:"list-heading"},(0,n.createElement)("span",{className:"no-travelers"},(0,T.__)("Number Of Travellers","wp-travel-engine")),(0,n.createElement)("span",{className:"price-per-person"},(0,T.__)("Price","wp-travel-engine")," ",t)),e?.map((({from:e,to:t,rate:a},r)=>(0,n.createElement)("li",{key:r},(0,n.createElement)("span",{className:"traveler-title"},`${e}${t?` - ${t}`:"+"}`),(0,n.createElement)("span",{className:"traveler-price"},(0,n.createElement)(L,{value:a}))))))},(0,n.createElement)("div",{className:"wpte-select-options wpte-group-discount-options wte-popper active"},(0,n.createElement)("button",{type:"buttton",className:"option-toggle"},(0,T.__)("Group Discount","wp-travel-engine")))),H=({items:e,onChange:t})=>{const{state:{availableSeats:a,summary:{travelers:r}}}=se(),l=(0,$.keyBy)(r,"id");return e.map((e=>{var i,s;const{id:c,price:o,sale_price:m,has_sale:p=!1,min_pax:d,age_group:u}=e,g=(0,$.isNumber)(a)?a-r.filter((({id:e})=>e!==c)).reduce(((e,{qty:t})=>e+t),0):1/0,v=(null!==(i=l?.[c]?.qty)&&void 0!==i?i:d)<d?d:null!==(s=l?.[c]?.qty)&&void 0!==s?s:d;let h=p?m:o;var w;e.has_group_pricing&&(h=null!==(w=e.group_pricing?.find((({from:e,to:t})=>t?v>=e&&v<=t:v>=e))?.rate)&&void 0!==w?w:h);const E=(0,$.isNumber)(g)||(0,$.isNumber)(e.max_pax)?parseInt(e.max_pax)<g?e.max_pax:g:1/0,b="/ "+e.pricing_type.label;return(0,n.createElement)(P,{key:c,label:e.label,price:h,ageGroup:u,hasSale:p,actualPrice:o,perTextLabel:b,counter:{min:d,max:E,onChange:e=>t(c,e),value:v},afterLabel:e.has_group_pricing&&(0,n.createElement)(G,{discountList:e.group_pricing,perTextLabel:b})})}))},F=()=>(0,n.createElement)(n.Fragment,null,(0,n.createElement)("span",{className:"text-left"},(0,T.__)("Travellers","wp-travel-engine")),(0,n.createElement)("span",{className:"text-right"},(0,T.__)("Quantity","wp-travel-engine"))),W=({onChange:e,onTravelerChange:t})=>{const a=se(),{state:{tripID:l,availableSeats:s,availableTripPackages:c,summary:o},setState:m}=a,{selectedTripPackageID:p,travelers:d}=o,u=(0,i.useSelect)((e=>e("wptravelengine").getTripPackages(l)),[l]),g=u.find((({id:e})=>e===p)),v=g?.traveler_categories||[],h=s>0||""===s;return(0,r.useEffect)((()=>{m({processToNext:o.travelers.reduce(((e,{qty:t})=>e+t),0)>0})}),[d]),(0,n.createElement)("div",{className:"wte-process-tab-content-wrapper"},(0,n.createElement)("div",null,(0,n.createElement)("div",{className:"wte-process-tab-content"},(0,n.createElement)("div",{className:"wte-button-group wte-package-type"},(0,n.createElement)(A,{options:c.map((e=>{const{name:t}=u.find((({id:t})=>t===e));return{label:t,value:e}})),selected:p,onChange:e})),g?.description&&(0,n.createElement)("div",{className:"wte-selected-package-description",dangerouslySetInnerHTML:{__html:g.description}}),(0,n.createElement)("hr",null),h?(0,n.createElement)(D,{heading:(0,n.createElement)(F,null)},(()=>(0,n.createElement)(H,{items:v,onChange:t}))):(0,n.createElement)("div",{className:"failed-msg"},(0,T.__)("Seats are not available for selected package","wp-travel-engine")))))};var j=a(1455),V=a.n(j);const Y={trips:{},isLoading:!0},z={setTrip:e=>({type:"SET_TRIP",data:e}),setTripDates:(e,t)=>({type:"SET_TRIP_DATES",id:t,data:e}),setTripServices:(e,t)=>({type:"SET_TRIP_SERVICES",id:t,data:e}),setTripPackages:(e,t)=>({type:"SET_TRIP_PACKAGES",id:t,data:e}),fetchFromAPI:e=>({type:"FETCH_FROM_API",path:e}),fetchTripData:(e,t="")=>({type:"FETCH_TRIP_DATA",id:e,path:t})},U={getState:e=>e,getTrip(e,t){var a;return null!==(a=e.trips?.[t]?.trip)&&void 0!==a?a:{}},getTripDates(e,t){var a;return null!==(a=e.trips?.[t]?.dates)&&void 0!==a?a:[]},getTripServices(e,t){var a;return null!==(a=e.trips?.[t]?.services)&&void 0!==a?a:[]},getTripPackages(e,t){var a;return null!==(a=e.trips?.[t]?.packages)&&void 0!==a?a:[]},isLoading:e=>e.isLoading},Z={FETCH_FROM_API:e=>V()({path:e.path}),FETCH_TRIP_DATA({id:e,path:t}){const{wpApiSettings:{root:a}}=window;return V()({url:`${a}wptravelengine/v2/trips/${e}/${t}`})}},J={*getTrip(e,t){const a=yield z.fetchTripData(e,t);return z.setTrip(a)},*getTripDates(e){const t=yield z.fetchTripData(e,"dates");return z.setTripDates(t,e)},*getTripServices(e){const t=yield z.fetchTripData(e,"services");return z.setTripServices(t,e)},*getTripPackages(e){const t=yield z.fetchTripData(e,"packages");return z.setTripPackages(t,e)}},K=(0,i.createReduxStore)("wptravelengine",{reducer:(e=Y,t)=>{const{type:a}=t;switch(a){case"SET_TRIP":return{...e,isLoading:!1,trips:{...e.trips,[t.data.id]:{...e.trips[t.data.id],trip:t.data}}};case"SET_TRIP_DATES":return{...e,isLoading:!1,trips:{...e.trips,[t.id]:{...e.trips[t.id],dates:t.data}}};case"SET_TRIP_SERVICES":return{...e,isLoading:!1,trips:{...e.trips,[t.id]:{...e.trips[t.id],services:t.data}}};case"SET_TRIP_PACKAGES":return{...e,isLoading:!1,trips:{...e.trips,[t.id]:{...e.trips[t.id],packages:t.data}}};default:return e}},actions:z,selectors:U,controls:Z,resolvers:J});(0,i.register)(K);const Q=({title:e,items:t})=>t.length<1?null:(0,n.createElement)("div",{className:"wte-booking-details"},(0,n.createElement)("h6",{className:"wte-booking-details-title"},e),(0,n.createElement)("ul",null,t?.map(((e,t)=>{const{label:a,qty:r,total:l,unitPrice:i,perTextLabel:s}=e;return r<1?null:(0,n.createElement)("li",{key:t},(0,n.createElement)("label",null,(0,n.createElement)("strong",null,`${r} ${a}`),(0,n.createElement)("span",{className:"qty"}," (",(0,n.createElement)(L,{value:i}),s,")")),(0,n.createElement)("div",{className:"amount-figure"},(0,n.createElement)("strong",null,(0,n.createElement)(L,{value:l}))))})))),X=()=>{const{state:{tripID:e,summary:t,availableTimes:a},state:l,setState:s,getTotal:c}=se(),{selectedTripDate:o,travelers:m,extraServices:p,selectedTripPackageID:d,selectedTimeSlot:u}=t,g=(v=e,(0,i.useSelect)((e=>e("wptravelengine").getTrip(v)),[v]));var v;(0,r.useEffect)((()=>{g&&s({...l,isLoading:!1})}),[g]);const h=(0,i.useSelect)((t=>t("wptravelengine").getTripPackages(e)),[e]).find((e=>e.id===d)),w=new wteL10n.dateFormat(o);return(0,n.createElement)("aside",{className:"wte-popup-sidebar"},(0,n.createElement)("div",{className:"wte-booking-summary"},(0,n.createElement)("div",{id:"wte-booking-summary"},(0,n.createElement)("h5",{className:"wte-booking-block-title"},(0,T.__)("Booking Summary","wp-travel-engine")),(0,n.createElement)("h2",{className:"wte-booking-trip-title",dangerouslySetInnerHTML:{__html:g?.title?.rendered||""}}),o&&(0,n.createElement)("div",{className:"wte-booking-dates"},(0,n.createElement)("p",{className:"wte-booking-starting-date"},(0,n.createElement)("strong",null,(0,T.__)("Starting Date:","wp-travel-engine"))," ",w.format(),u&&` at ${moment(a.find((({key:e})=>e===u))?.from).format("h:mm A")}`)),(0,n.createElement)("div",{className:"wte-booking-summary-info"},h&&(0,n.createElement)("h5",{className:"wte-booking-summary-info-title",dangerouslySetInnerHTML:{__html:`${(0,T.__)("Package:","wp-travel-engine")} ${h.name}`}}),(0,n.createElement)("div",{className:"wte-booking-trip-info"},(0,n.createElement)(Q,{title:(0,T.__)("Travellers","wp-travel-engine"),items:m}),p.find((({total:e})=>e>0))&&(0,n.createElement)(Q,{title:wteL10n?.l10n?.extraServicesTitle||(0,T.__)("Extra Services","wp-travel-engine"),items:p})),(0,n.createElement)("div",{className:"total-amount"},(0,n.createElement)("p",{className:"price"},(0,n.createElement)("span",{className:"total-text"},(0,T.__)("Total :","wp-travel-engine")),(0,n.createElement)(L,{value:c()})))))))},ee=({tabs:e=[],onSubmit:t,processToNext:a})=>{const l=(0,r.useRef)(null),{isLoading:i,state:{availableTimes:s,currentTab:c},state:o,setState:m}=se(),p=e.filter((e=>e?.enabled)),d=100/e.length,[u,g]=(0,r.useState)({current:0,completed:[],barWidth:d}),{current:v,completed:h,barWidth:w}=u;return(0,r.useEffect)((()=>{s.length>0&&l.current.scrollTo({top:l.current.scrollHeight,left:0,behavior:"smooth"})}),[s]),(0,n.createElement)(n.Fragment,null,(0,n.createElement)("nav",{className:"wte-process-nav"},(0,n.createElement)("div",{className:"wte-process-container"},(0,n.createElement)("ul",{className:"wte-process-nav-list",style:{"--step-bar-width":`${w}%`}},p.map(((e,t)=>{const{id:r,title:l,icon:i}=e,s=c===t?"active":"",p=h.includes(t)?"finish":"",v=h?.includes(t);return(0,n.createElement)("li",{key:t,id:r,className:`wte-process-nav-item ${s} ${p}`},(0,n.createElement)("a",{href:"#",onClick:e=>{e.preventDefault(),a&&v&&g({...u,completed:[...h,!h.includes(t)&&c],barWidth:d*(t+1)}),a&&v&&m({...o,currentTab:t})}},i&&(0,n.createElement)("span",{className:"wte-icon"},i),l,(0,n.createElement)("span",{className:"arrow"},(0,n.createElement)(f,{icon:"angle-right"}))))}))))),(0,n.createElement)("div",{className:"wte-process-tabs"},(0,n.createElement)("div",{className:"wte-process-container"},(0,n.createElement)("div",{ref:l,className:"wte-process-tab-item"+(i?" loading":""),style:{display:"block"}},!i&&p[c]?.component),(0,n.createElement)("div",{className:"wte-process-tab-controller"},0!==c&&(0,n.createElement)("button",{type:"button",className:"wte-process-btn wte-process-btn-prev",onClick:()=>{c>0&&(g({...u,barWidth:w-d}),m({...o,currentTab:c-1}))}},(0,n.createElement)(f,{icon:"angle-left"}),(0,T.__)("Back","wp-travel-engine")),(0,n.createElement)("button",{type:"button",className:"wte-process-btn wte-process-btn-next",onClick:()=>{a&&c<p.length-1&&(g({...u,completed:[...h,!h.includes()&&c],barWidth:w+d}),m({...o,currentTab:c+1})),a&&c===p.length-1&&t()},disabled:!a},p.length-1===c?(0,T.__)("Proceed To Checkout","wp-travel-engine"):(0,T.__)("Continue","wp-travel-engine"))))))},te={isOpen:!1,availableSeats:0,availableTripPackages:[],availableTimes:[],processToNext:!1,isLoading:!0,currentTab:0,summary:{selectedTripDate:null,selectedTimeSlot:null,selectedTripPackageID:null,travelers:[],extraServices:[]}},ae=(e,t={},a=null,n=null)=>{var r;const l=(0,$.keyBy)(null!==(r=t.travelers)&&void 0!==r?r:[],"id");return e.map((e=>{const{id:t,min_pax:r,has_sale:i,sale_price:s,price:c,pricing_type:o,has_group_pricing:m,group_pricing:p,label:d}=e;if(n&&n!==t)return l[t];let u=i?s:c;const g=null!=a?a:r;var v;m&&(u=null!==(v=p.find((({from:e,to:t})=>t?g>=e&&g<=t:g>=e))?.rate)&&void 0!==v?v:u);let h=0!==g&&"per-group"===o.value?u:g*u;return{id:t,qty:g,unitPrice:u,total:h,label:d,perTextLabel:` / ${o.label}`}}))},ne=({tripID:e,nonce:t,wpXHR:a,cartVersion:s,parentRef:c=null,...o})=>{const[m,p]=(0,r.useState)({...te,tripID:e}),d=e=>p((t=>({...t,...e}))),{isOpen:u,summary:g,availableSeats:v,isLoading:h}=m,{travelers:w,extraServices:E,selectedTripPackageID:b,selectedTripDate:y,selectedTimeSlot:k}=g,_=(0,i.useSelect)((t=>t("wptravelengine").getTripServices(e)),[e]),x=(0,i.useSelect)((t=>t("wptravelengine").getTripDates(e)),[e]),S=(0,i.useSelect)((t=>t("wptravelengine").getTripPackages(e)),[e]),N=S.find((({id:e})=>e===b))?.traveler_categories||[];function L(){return Object.values(w).reduce(((e,t)=>e+t.total),0)+Object.values(E).reduce(((e,t)=>e+t.total),0)}function C(e){p((t=>({...t,summary:{...t.summary,...e}})))}function P(e){C({selectedTripDate:e,selectedTimeSlot:null})}return(0,r.useEffect)((()=>{document.dispatchEvent(new Event("bookingCalendarReady"))}),[]),(0,r.useEffect)((()=>{window.wptravelengineBooking=window.wptravelengineBooking||{},window.wptravelengineBooking.store={state:m,setState:e=>{p((t=>({...t,...e})))},setTripDate:P,setSummary:C}}),[]),(0,r.useEffect)((()=>{const e=_.filter((({required:e})=>e)).flatMap((e=>e.options.map((e=>{const{key:t,price:a,label:n,serviceUnit:r}=e;return{id:t,label:n,unitPrice:a,qty:0,total:0,perTextLabel:`/ ${r.label}`,required:!0}})))),t=v>=N.reduce(((e,{min_pax:t})=>e+t),0)||""===v;d({processToNext:!!b,summary:{...g,travelers:t?ae(N):[],extraServices:e}})}),[b]),(0,r.useEffect)((()=>{if(y){var e;const t=x.filter((({dates:e})=>!!e[y]));let a=t.reduce(((e,{dates:t})=>[...e,...t?.[y].times||[]]),[]);a=a.map((e=>{const a=t.find((({dates:t})=>t[y].times.find((({key:t})=>t===e.key)))).package.id;return{...e,package_id:a}}));let n=[];n=a.length<1?t.map((({package:e})=>e.id)):t.filter((({dates:e})=>e[y].times.find((({key:e})=>e===k)))).map((({package:e})=>e.id));const r=null!==(e=n[0])&&void 0!==e?e:null,l=t.find((({package:e})=>e.id===r))?.dates?.[y],i=0===l?.times.length?l?.seats:l?.times.find((({key:e})=>e===k))?.seats;d({summary:{...g,selectedTripPackageID:r},availableSeats:i,availableTripPackages:n,availableTimes:a,processToNext:!!y&&r})}}),[y,k,x]),(0,n.createElement)(ie.Provider,{value:{state:m,setState:d,getTotal:L,updateSummary:C}},(0,n.createElement)("p",{style:{display:"none"}},"WP Travel Engine Booking Initialized."),(0,n.createElement)(l,{isOpen:u,setIsOpen:()=>{d({isOpen:!m.isOpen})}},(0,n.createElement)("div",{className:"wte-process-layout "+(h?"is-loading":"")},(0,n.createElement)(ee,{processToNext:m.processToNext,onSubmit:async function(){const n=m.availableTimes.find((e=>e.key===k));let r=w.filter((e=>e.qty>0));r=r.length>0?r:[];let l={},i=0,c=r.reduce(((e,t)=>{const a=N.find((e=>e.id===t.id));return l[t.id]=t.qty,i+=t.qty,e[t.id]={pax:t.qty,salePrice:t.unitPrice,groupDiscountPrice:0,cost:t.unitPrice,categoryInfo:{label:a.label,price:a.price,enabledSale:a.has_sale,salePrice:a.sale_price,minPax:a.min_pax,maxPax:a.max_pax,groupPricing:a.group_pricing,enabledGroupDiscount:a.has_group_pricing,pricingType:a.pricing_type.value}},e}),{}),o={cartTotal:L(),nonce:t,packageID:b,pricingOptions:c,timeRange:n&&[n.from,n.to],traveler:i,tripDate:y,travelers:l,tripID:e,tripTime:n&&n.from,cartVersion:s};if(E.length>0){const e=E.filter((e=>0!==e.qty));o={...o,extraServices:e.map((e=>({extra_service:e.label,price:e.unitPrice,qty:e.qty})))}}const p=await fetch(`${a}?action=wte_add_trip_to_cart&cart_version=${o.cartVersion}&_nonce=${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!p.ok)throw new Error(p.statusText);try{const e=await p.json();if(e.success)return window.location.href=e.data.redirect,e;if(e.data&&e.data[0])throw new Error(e.data[0])}catch(e){throw Error(e.message)}},tabs:[{id:"date-time",title:(0,T.__)("Date & Time","wp-travel-engine"),component:(0,n.createElement)(R,{onTimeChange:function(e){C({selectedTimeSlot:e})},onDateChange:P}),icon:(0,n.createElement)(f,{icon:"calendar"}),enabled:!0},{id:"package-type",title:(0,T.__)("Package Type","wp-travel-engine"),component:(0,n.createElement)(W,{onChange:function(e){var t;d({availableSeats:null!==(t=x.filter((({dates:e})=>!!e[y])).find((({package:t})=>t.id===e))?.dates?.[y]?.seats)&&void 0!==t?t:"",summary:{...g,selectedTripPackageID:e}})},onTravelerChange:function(e,t){C({travelers:ae(N,g,t,e)})}}),icon:(0,n.createElement)(f,{icon:"suitcase"}),enabled:!0},{id:"extra-services",title:(0,T.__)("Extra Services","wp-travel-engine"),component:(0,n.createElement)(O,null),icon:(0,n.createElement)(f,{icon:"dots"}),enabled:_.length>0}]}),(0,n.createElement)(X,null))))};var re=a(6109),le=a.n(re);window.wptravelengineBooking=window.wptravelengineBooking||{},window.wptravelengineBooking.app=ne;const ie=(0,r.createContext)();function se(){return(0,r.useContext)(ie)}le()((()=>{var e,t;let a=null!==(e=document.querySelector("#wptravelengine-trip-booking-modal"))&&void 0!==e?e:null;a||(a=document.createElement("div"),a.style.display="none",a.style.height=0,a.id="wptravelengine-trip-booking-modal",document.body.appendChild(a)),(0,r.createRoot)(a).render((0,n.createElement)(r.StrictMode,null,(0,n.createElement)(ne,{parentRef:a,...JSON.parse(null!==(t=a.dataset.tripBooking)&&void 0!==t?t:"{}")}))),document.querySelectorAll("[data-trip-booking],#open-booking-modal,.wte-fsd-list-booknow-btn")?.forEach((e=>{var t;const a=JSON.parse(null!==(t=e.dataset.tripBooking)&&void 0!==t?t:"{}");if(a.isOpen=!0,"button"===e.tagName.toLowerCase()&&(e.disabled=!1),e.classList.contains("wte-fsd-list-booknow-btn")&&(e.disabled=!1,e.classList.remove("btn-loading"),!a.tripID&&document.body.classList.contains("single-trip"))){a.tripID=document.body.className.match(/postid-(\d+)/)?.[1];const t=e.dataset.info;t&&(a.summary={selectedTripDate:moment(1e3*+t).format("YYYY-MM-DD")})}e.addEventListener("click",(()=>{var e;const{state:t,setState:n,setTripDate:r}=window.wptravelengineBooking.store;setTimeout((()=>{n({isOpen:!0})})),n({summary:{...t.summary,selectedTripDate:null!==(e=a.summary?.selectedTripDate)&&void 0!==e?e:null}})}))}))}))}}]);